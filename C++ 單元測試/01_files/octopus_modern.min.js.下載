!function(){"use strict";const t=t=>{const e=new RegExp(`[?&]${t}=([^&]*)`).exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))},e={post(t,e){return this.request("POST",t,e)},get(t,e=""){return this.request("GET",t,e)},request:(t,e,n)=>new Promise((i,o)=>{const a=new XMLHttpRequest;a.open(t,e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.withCredentials=!0,a.onload=function(){4===a.readyState&&200===a.status&&""!==a.response?i(JSON.parse(a.response)):o(a)},a.onerror=(()=>{o(a)}),a.send(n)})},n=(t,e=!1)=>{const n=t.getFullYear(),i=`0${t.getMonth()+1}`.slice(-2),o=`0${t.getDate()}`.slice(-2);return e?`${n} 年 ${i} 月 ${o} 日`:`${n}-${i}-${o}`},i=t=>{const e=document.createElement("a");e.href=t,e.target="_blank",e.rel="noopener",e.click()},o=t=>t.replace(/ /g,"_"),a=t=>{if("SCRIPT"===t.tagName)return t.parentNode.replaceChild(s(t),t),t;let e=0,n=t.childNodes;for(;e<n.length;)a(n[e++]);return t},s=t=>{let e=document.createElement("script");e.text=t.innerHTML;for(let n=t.attributes.length-1;n>=0;n--)e.setAttribute(t.attributes[n].name,t.attributes[n].value);return e},l=()=>{if(document.body.dataset.hasOwnProperty("adsenseState"))return"block"===document.body.dataset.adsenseState.toLocaleLowerCase()},c="https://pixoctopus.pixnet.net/projects";class r{constructor(t){this.initProperties(t)}initProperties(t){this.project_id=t.project_id,this.project_name=t.project_name,this.platform_name=t.platform_name,this.product_id=t.product_id,this.platform_data=t.platform_data||{},this.widget_type=t.widget_type,this.widget_content=t.widget_content,this.isPreview=t.isPreview,this.octopusTags=t.octopusTags,this.articleTitle=t.articleTitle,this.pv_link=t.pv_link,this.pv_load_link=t.pv_load_link,this.label=t.label||"noLabel",this.click_link=t.click_link,this.zone3_type=t.zone3_type,this.ga=t.widget_content.ga,this.content_type=t.content_type,this.delayTime=1e3,this.supportsPassive=(()=>{let t=!1;try{const e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t})()}initGoogleAnalytics(){var t,e,n,i,o,a;t=window,e=document,n="script",i="ga",t.GoogleAnalyticsObject=i,t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,o=e.createElement(n),a=e.getElementsByTagName(n)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(o,a),ga("create",this.widget_content.ga,"auto",{name:this.gaName}),ga(`${this.gaName}.set`,"forceSSL",!0),ga(`${this.gaName}.send`,"pageview")}recordPaEvent(t){const e=window._piq||window.top._piq;e.push(["trackEvent","octopusProject",t,this.project_id,Number.parseInt(this.project_id,10)]),e.push(["trackEvent","octopusSupplier",t,this.platform_name,Number.parseInt(this.project_id,10)]),e.push(["trackEvent","octopusWidget",t,this.widget_type,Number.parseInt(this.project_id,10)]),e.push(["trackEvent","octopusProductId",t,this.product_id,Number.parseInt(this.project_id,10)]);const n=this.octopusTags.length;for(let i=0;i<n;i++)e.push(["trackEvent","octopusTag",t,this.octopusTags[i],Number.parseInt(this.project_id,10)])}sendTrackEvent(t){(new Image).src=t}}const d=t=>{const e=t.description||"",n=t.img_link||"",i=t.title;let o=function(t){let e=t.link,n=e.includes("?")?"&":"?",i=function(t){let e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length;for(let o=0;o<t;o++)e+=n.charAt(Math.floor(Math.random()*i));return e}(40);return`${e}${n}click_id=${i}`}(t);const a=t.price||"",s=t.original_price||"",l=t.button_name,c=t.html||"";let r="";e&&(r=`<a href="${o}" target="_blank" rel="nofollow noopener"><span class="related__subtitle">${e}</span></a>`);let d="";n&&(d=`<a href="${o}" target="_blank" rel="nofollow noopener"><img class="related__img" src="${n}"></a>`);let h="";return c&&(h=`<a href="${o}" target="_blank" rel="nofollow noopener">${c}</a>`),`\n            <div class="related" data-title="${i}" data-link="${o}" data-price="${a}" data-original-price="${s}" data-description="${e}" data-img-link="${n}" data-button-name="${l}">\n                <a href="${o}" target="_blank" rel="nofollow noopener"><h3 class="related__title">${i}</h3></a>\n                ${r}\n                ${d}\n                ${h}\n                <a class="related__reserve" href="${o}" target="_blank" rel="nofollow noopener">${l}</a>\n            </div>`};class h extends r{initProperties(t){super.initProperties(t),this.gaName="relatedPrdTracker"}bindEvent(t){t.addEventListener("click",t=>{const e=document.querySelector(".related__content"),n=t.target,o={related__title:"title",related__subtitle:"description",related__img:"image",related__reserve:"button"};let a=this.click_link.match(/\?/)?"&":"?",s="other";this.isDescendant(e,n)&&(s="description");for(const t in o)if(0<=n.className.indexOf(t)){s=o[t];break}this.widget_content.link?(this.recordGaEvent("click",!0),this.recordPaEvent("click_"+s),super.sendTrackEvent(`${this.click_link}${a}position=${s}`),"related"===n.className&&i(`${this.widget_content.link}`)):t.preventDefault()});let e=!1,n=window.self!==window.top?window.top.document.getElementById("in-read-rp"):t;const o=()=>{e||window.top.requestAnimationFrame(()=>{n.offsetTop<window.top.pageYOffset+window.top.innerHeight&&n.offsetTop+n.offsetHeight>window.top.pageYOffset?(super.sendTrackEvent(this.pv_link),this.recordGaEvent("scroll_into_view",!0),this.recordPaEvent("scroll_into_view"),window.top.removeEventListener("scroll",o)):e=!1}),e=!0};window.top.addEventListener("scroll",o)}isDescendant(t,e){let n=e.parentNode;for(;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}trace(){super.initGoogleAnalytics(),super.recordPaEvent("imps"),setTimeout(()=>{this.recordGaEvent("load",!1),this.recordPaEvent("load")},this.delayTime)}recordGaEvent(t,e){ga(`${this.gaName}.send`,"event",`${this.project_id}_RP_${this.project_name}`,t,{nonInteraction:!e})}recordPaEvent(t){window.top._piq.push(["trackEvent",`${this.project_id}_RP_${this.project_name}`,t,this.label])}compileHtml(){return d(this.widget_content)}}const _=(t,e)=>{const i=new Date,o=new Date(i.getTime()+6048e5),a=new Date(i.getTime()+6912e5),s=n(i),l=n(o),c=n(a),r=n(o,!0),d=n(a,!0),h=e.area_en||"",_=e.area_tw||"",p=e.name_en||"",u=e.name_tw||"",g=e.item_count||"",m=e.title,v=e.area_en||"",w=e.button_name||"",f=e.star_rating||"",k=e.image_url||"";let b="";"off"===e.enable_entry_date&&(b='hidden="true"');let $="";return"off"===e.enable_exit_date&&($='hidden="true"'),{hotels_compare:function(){let t="";for(let e=0;e<f;e++)t+='<span class="hotelc__info__star--yellow"></span>';for(let e=f;e<5;e++)t+='<span class="hotelc__info__star--gray"></span>';let e="";k&&(e=`style="background-image: url('${k}')"`);return`<div class="hotelc-box" data-type="hotel" data-place="${h}" data-name-en="${p}" data-name-tw="${u}">\n            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none;">\n                <defs>\n                    <g id="icon-arrow--down">\n                        <path d="M1 0l5 6.996m0 0L11 0" stroke-linecap="square" stroke="currentColor" fill="none"/>\n                    </g>\n                    <g id="icon-arrow--right" fill="none" fill-rule="evenodd">\n                        <path d="M-349-58H26V2h-375z"/>\n                        <path d="M0 12l6-6M0 0l6 6" stroke="currentColor" stroke-linecap="square"/>\n                    </g>\n                </defs>\n            </svg>\n            <div class="hotelc__header">${m}</div>\n            <div class="hotelc__block1">\n                <a id="hotelc-info" href="https://www.hotelscombined.com.tw/Hotel/Search?fileName=${p}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&a_aid=132653&label=hotelinfoSingle" target="_blank" rel="nofollow noopener">\n                    <div class="hotelc__info">\n                        <div>\n                            <div class="hotelc__info__img" ${e}></div>\n                        </div>\n                        <div>\n                            <div class="hotelc__info__name">${u}</div>\n                            <div class="hotelc__info__place">${_}</div>\n                            <div>\n                                ${t}\n                                <span class="hotelc__info__star__txt">${f}星級飯店</span>\n                            </div>\n                        </div>\n                    </div>\n                </a>\n                <div class="hotelc__date-btn-container">\n                    <div class="hotelc__date-btn" ${b}>\n                        <div class="hotelc__date-btn__text">入住日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${r}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-btn" ${$}>\n                        <div class="hotelc__date-btn__text">退房日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${d}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-inputs">\n                        <input class="hotelc__date-input" type="date" value="${l}" min="${s}">\n                        <input class="hotelc__date-input" type="date" value="${c}" min="${c}">\n                    </div>\n                </div>\n            </div>\n            \x3c!-- 資料讀取中 --\x3e\n            <div class="hotelc__loading">\n                <div class="hotelc__loading-icon">資料讀取中</div>\n                <a class="hotelc__loading-link hotelc-links" id="hotelc-link--loading-continue" href="https://www.hotelscombined.com.tw/Hotel/Search?fileName=${p}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&a_aid=132653&label=loadingSingle" target="_blank" rel="nofollow noopener">等不及了嗎，直接前往查看更多</a>\n            </div>\n            <div class="hotelc__result">\n                <ul class="hotelc__result__list single--b"></ul>\n                <div class="hotelc__notes hotelc__notes--last">\n                    <a class="hotelc-links" id="hotelc-link--more" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${h}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=moreSingle&sort=MinRate-asc" target="_blank" rel="nofollow noopener">看更多${_}飯店</a><br>\n                    <a class="hotelc-powerby" href="https://www.hotelscombined.com.tw?a_aid=132653&label=powerbySingle" target="_blank" rel="nofollow noopener">\n                        <img src="https://front.pixfs.net/coblog/img/logo--hotelc.png" class="hotelc-powerby__img" alt="資料提供：HotelsCombined">\n                    </a>\n                </div>\n            </div>\n            \x3c!-- 資料錯誤 --\x3e\n            <div class="hotelc__nodata">\n                <div class="hotelc__notes">\n                    由於資料過多<br>\n                    請前往 HotelsCombined 看詳細結果\n                </div>\n                <a class="hotelc__btn hotelc__btn--blue hotelc-links" id="hotelc-link--fail-continue" href="https://www.hotelscombined.com.tw/Hotel/Search?fileName=${p}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&a_aid=132653&label=nodataSingle" target="_blank" rel="nofollow noopener">\n                    立即前往\n                    <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                        <use xlink:href="#icon-arrow--right"></use>\n                    </svg>\n                </a>\n            </div>\n        </div>`}(),hotels_recommend:`<div class="hotelc-box" data-type="place" data-place="${h}" data-name-en="${p}" data-name-tw="${u}" data-item-count="${g}">\n            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none;">\n                <defs>\n                    <g id="icon-arrow--down">\n                        <path d="M1 0l5 6.996m0 0L11 0" stroke-linecap="square" stroke="currentColor" fill="none"/>\n                    </g>\n                    <g id="icon-arrow--right" fill="none" fill-rule="evenodd">\n                        <path d="M-349-58H26V2h-375z"/>\n                        <path d="M0 12l6-6M0 0l6 6" stroke="currentColor" stroke-linecap="square"/>\n                    </g>\n                </defs>\n            </svg>\n            <div class="hotelc__header">${m}</div>\n            <div class="hotelc__block1">\n                <div class="hotelc__date-btn-container">\n                    <div class="hotelc__date-btn" ${b}>\n                        <div class="hotelc__date-btn__text">入住日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${r}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-btn" ${$}>\n                        <div class="hotelc__date-btn__text">退房日期</div>\n                        <div class="hotelc__date-btn__date">\n                            <span>${d}</span>\n                            <svg class="icon-arrow--down" viewBox="0 0 12 8">\n                                <use xlink:href="#icon-arrow--down"></use>\n                            </svg>\n                        </div>\n                    </div>\n                    <div class="hotelc__date-inputs">\n                        <input class="hotelc__date-input" type="date" value="${l}" min="${s}">\n                        <input class="hotelc__date-input" type="date" value="${c}" min="${c}">\n                    </div>\n                </div>\n            </div>\n            \x3c!-- 資料讀取中 --\x3e\n            <div class="hotelc__loading">\n                <div class="hotelc__loading-icon">資料讀取中</div>\n                <a class="hotelc__loading-link hotelc-links" id="hotelc-link--loading-continue" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${v}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=loadingArea" target="_blank" rel="nofollow noopener">等不及了嗎，直接前往查看更多</a>\n            </div>\n            <div class="hotelc__result">\n                <ul class="hotelc__result__list multi--b"></ul>\n                <a class="hotelc__btn hotelc__btn--green hotelc-links" id="hotelc-link--more" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${v}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=moreArea" target="_blank" rel="nofollow noopener">\n                    ${w}\n                    <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                        <use xlink:href="#icon-arrow--right"></use>\n                    </svg>\n                </a>\n                <div class="hotelc__notes hotelc__notes--last">\n                    <a class="hotelc-powerby" href="https://www.hotelscombined.com.tw?a_aid=132653&label=powerbyArea" target="_blank" rel="nofollow noopener">\n                        <img src="https://front.pixfs.net/coblog/img/logo--hotelc.png" class="hotelc-powerby__img" alt="資料提供：HotelsCombined">\n                    </a>\n                </div>\n            </div>\n            \x3c!-- 資料錯誤 --\x3e\n            <div class="hotelc__nodata">\n                <div class="hotelc__notes">\n                    由於資料過多<br>\n                    請前往 HotelsCombined 看詳細結果\n                </div>\n                <a class="hotelc__btn hotelc__btn--blue hotelc-links" id="hotelc-link--fail-continue" href="https://www.hotelscombined.com.tw/Hotels/Search?destination=place:${v}&checkin=${l}&checkout=${c}&rooms=1&adults_1=2&languageCode=TW&sortField=consumerRating&a_aid=132653&label=nodataArea" target="_blank" rel="nofollow noopener">\n                    立即前往\n                    <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                        <use xlink:href="#icon-arrow--right"></use>\n                    </svg>\n                </a>\n            </div>\n        </div>`,hotels_search:'<div class="hotels-search">\n            <ins class="bookingaff" data-aid="846006" data-target_aid="835804" data-prod="nsb" data-width="265" data-height="360" data-lang="xt" data-currency="TWD">\n            \x3c!-- Anything inside will go away once widget is loaded. --\x3e\n                <a href="https://www.booking.com?aid=835804" target="_blank" rel="nofollow noopener">Booking.com</a>\n            </ins>\n        </div>'}[t]||""};class p extends r{initProperties(t){super.initProperties(t),this.gaName="hotelcTracker",this.widget_content.ga=t.widget_content&&t.widget_content.ga||"UA-65168598-12",this.platform_data.date={},this.label=t.label,this.firstResult=!0,this.isHotel="hotels_compare"===this.widget_type,this.today=new Date,this.todayStr=this.formateDate(this.today),this.stateNow="loading",this.clickedCheckinDate=!1,this.clickedCheckoutDate=!1,this.changedCheckinDate=!1,this.changedCheckoutDate=!1,this.defaultDate={hotelcCheckin:this.formateDate(new Date(this.today.getTime()+6048e5)),hotelcCheckout:this.formateDate(new Date(this.today.getTime()+6912e5))},this.isHotelRecommendDiy="hotel_recommend_diy"===t.widget_type,this.traceResult={result:()=>{this.recordHotelcPaEvent("load")},fail:()=>{this.recordHotelcPaEvent("load hotel fail")},nodata:()=>{this.recordHotelcPaEvent("load hotel fail")}}}compileHtml(){const t=Object.assign({},this.widget_content,this.platform_data);return this.isHotelRecommendDiy?this.widget_content.html:_(this.widget_type,t)}compileScript(){const t=document.createElement("script");t.innerHTML='\n            (function(d, sc, u) {\n                var s = d.createElement(sc), p = d.getElementsByTagName(sc)[0]; s.type = \'text/javascript\';\n                s.async = true;\n                s.src = u + \'?v=\' + (+new Date());\n                p.parentNode.insertBefore(s,p);\n            })(document, \'script\', \'https://aff.bstatic.com/static/affiliate_base/js/flexiproduct.js\');\n            dataLayer.push({\n                "c2a" : "hotels",\n                "event" : "hotelc2a-hcsearch-imp",\n                "eventLabel": "BK2"\n            });',document.getElementsByTagName("head")[0].appendChild(t)}trace(){if(this.isHotelRecommendDiy)return void this.initGoogleAnalytics();this.initSets();const t=this.hotelcBlock.result.querySelectorAll(".hotelc__table--avg--link"),e=t.length;for(let n=0;n<e;n++){const e=t[n].dataset.label;this.recordHotelLabelPaEvent("imps",e)}}initGoogleAnalytics(){super.initGoogleAnalytics()}initSets(){this.initGoogleAnalytics(),this.initDomElement(),this.initDate()}bindEvent(t){if(this.isHotelRecommendDiy)return this.bindScrollIntoView(t),void this.recordEvent("load_zone2",this.otherEventLabel);this.recordEvent("load_zone2",this.hcEventLabel),t.addEventListener("click",t=>{const e=t.target;if(!this.hotelcBlock.result.contains(e)||e.classList.contains("hotelc__notes"))return;let n,i=this.click_link.match(/\?/)?"&":"?";if(this.hotelcBlock.hotels.contains(e)){const t={hotelc__img:"image",hotelc__info__name:"title"};let o=this.findAncestor(e,"hotelc__table--avg--link"),a=o&&o.dataset||{},s=a.name,l=a.label&&a.label.charAt(0);for(const i in t)if(0<=e.className.indexOf(i)){n=t[i];break}n&&(super.sendTrackEvent(`${this.click_link}${i}position=${n}&extra=${s}`),this.recordEvent(`click_on_${n}`,`${this.hcEventLabel}::${o.href}`));const c=864e5,r=new Date(this.inputBtn.true[0].value).getTime(),d=new Date(this.inputBtn.true[1].value).getTime(),h=Math.round(Math.abs((r-d)/c));this.changedCheckinDate&&this.recordEvent("check_in_date_days_away_from_today",this.hcEventLabel,h),this.changedCheckoutDate&&this.recordEvent("check_out_date_days_away_from_today",this.hcEventLabel,h),l&&this.recordEvent("click_on_price_compare",`${l}::${this.hcEventLabel}::${o.href}`)}switch(e.id){case"hotelc-info":return void this.recordHotelcPaEvent("click_hotel info");case"hotelc-link--more":return this.recordEvent(this.isHotel?"click_on_more_about_this_hotel_link":"click_on_more_recommendations_button",`${this.hcEventLabel}::${e.href}`),this.recordHotelcPaEvent("click_button"),void super.sendTrackEvent(`${this.click_link}${i}position=button`);case"hotelc-link--more-price":return this.recordEvent("click_on_more_recommendations_button",`${this.hcEventLabel}::${e.href}`),this.recordHotelcPaEvent("click_button"),void super.sendTrackEvent(`${this.click_link}${i}position=button`)}if("hotelc-powerby__img"===e.className)return this.recordEvent("click_on_hc_logo",this.hcEventLabel),this.recordHotelcPaEvent("click_description"),void super.sendTrackEvent(`${this.click_link}${i}position=description`);this.recordHotelcPaEvent("click_"+n),super.recordPaEvent("click")}),this.bindInputBtn(),this.bindScrollIntoView(t)}get hcEventLabel(){return`${this.platform_data.name_tw}::${location.href}`}get otherEventLabel(){return location.href}bindScrollIntoView(t){let e=!1;const n=()=>{e||window.requestAnimationFrame(()=>{t.offsetTop<window.pageYOffset+window.screen.height&&t.offsetTop+t.offsetHeight>window.pageYOffset?(super.sendTrackEvent(this.pv_link),super.recordPaEvent("imps"),this.recordHotelcPaEvent("imps"),this.recordEvent("scroll_into_view",this.isHotelRecommendDiy?this.otherEventLabel:this.hcEventLabel),window.removeEventListener("scroll",n)):e=!1}),e=!0};window.addEventListener("scroll",n,!!this.supportsPassive&&{passive:!0})}findAncestor(t,e){return t.classList.contains(e)?t:t.classList.contains("octopus")?t:this.findAncestor(t.parentElement,e)}initDomElement(){this.inputBtn={fake:document.getElementsByClassName("hotelc__date-btn__date"),true:document.getElementsByClassName("hotelc__date-input")},this.links=document.getElementsByClassName("hotelc-links"),this.hotelcBlock={info:document.getElementsByClassName("hotelc__info")[0],loading:document.getElementsByClassName("hotelc__loading")[0],result:document.getElementsByClassName("hotelc__result")[0],fail:document.getElementsByClassName("hotelc__nodata")[0],hotels:document.getElementsByClassName("hotelc__result__list")[0]}}initDate(){const t=t=>{const e=function(t){const e=`; ${document.cookie}`.split(`; ${t}=`);if(2===e.length)return e[1].split(";")[0];return!1}(t);return e&&e>this.defaultDate[t]?e:this.defaultDate[t]};this.changeHotelcDate(t("hotelcCheckin"),t("hotelcCheckout")),this.inputBtn.true[0].value=this.platform_data.date.checkin,this.inputBtn.true[1].value=this.platform_data.date.checkout,this.changeDateZh(0,this.platform_data.date.checkin),this.changeDateZh(1,this.platform_data.date.checkout)}getHotelData(){const t={checkin_date:this.platform_data.date.checkin,checkout_date:this.platform_data.date.checkout,label:this.label,limit:this.widget_content.item_count||3};var e,n;this.isHotel?(t.type="hotel",t.hotel_identity=o(this.platform_data.name_en)):(t.type="place",t.hotel_identity=o(this.platform_data.area_en)),(e="https://pixoctopus.pixnet.net/api/hotelscombined",n=t,new Promise((t,i)=>{const o=new XMLHttpRequest;let a=`${e}?type=${n.type}&checkin_date=${n.checkin_date}&checkout_date=${n.checkout_date}&label=${n.label}&hotel_identity=${n.hotel_identity}&limit=${n.limit}`;o.open("GET",a,!0),o.onload=(()=>{200===o.status?t(o.response):i(o)}),o.onerror=(()=>{i(o)}),o.send()})).then(t=>{const e=JSON.parse(t);this.isHotel&&e.order_info?this.showResult(e.order_info):e.hotels&&Array.isArray(e.hotels)?this.showResult(e.hotels):this.changeState("nodata")},()=>{this.changeState("fail")})}changeState(t){"loading"!==t&&this.traceResult[t]();(()=>{"nodata"===t&&(t="fail"),this.hotelcBlock[this.stateNow].style.display="none",this.stateNow=t,this.hotelcBlock[t].style.display="block"})()}showResult(t){let e="";const n=t.length;if(this.isHotel){for(let a=0;a<n;a++){let n=`<li class="hotelc__table--highline hotelc__table--highline--red">\n                        <a class="hotelc__table--avg hotelc__table--avg--link hotelc__table--avg--inside-border hotelc__table--avg--60" href="${t[a].book_url}" target="_blank" data-label="1-${o(t[a].logo)}-${this.platform_data.name_tw}" data-name="${t[a].name}">\n                            <div>\n                                <div class="hotelc__logo" style="background-image: url('${t[a].logo}')"></div>\n                            </div>\n                            <div>\n                                <div class="hotelc__price hotelc__price--red">NT$<span>${i(t[a].price)}</span></div>\n                            </div>\n                        </a>\n                    </li>\n                    <a class="hotelc__btn hotelc__btn--red" id="hotelc-link--more-price" href="${t[a].book_url}" target="_blank">${this.widget_content.button_name}\n                        <svg class="icon-arrow--right" viewBox="0 0 8 12"><use xlink:href="#icon-arrow--right"></use></svg>\n                    </a>`;0<a&&(n=`<li class="border-top-1">\n                            <a class="hotelc__table--avg hotelc__table--avg--link hotelc__table--avg--inside-border hotelc__table--avg--60" href="${t[a].book_url}" target="_blank" data-label="${a+1}-${o(t[a].logo)}-${this.platform_data.name_tw}">\n                                <div>\n                                    <div class="hotelc__logo" style="background-image: url('${t[a].logo}')"></div>\n                                </div>\n                                <div>\n                                    <div class="hotelc__price">NT$<span>${i(t[a].price)}</span></div>\n                                </div>\n                            </a>\n                        </li>`),"https://cdn.datahc.com/Images/providers/logos/"===t[a].logo&&(n=n.replace(` style="background-image: url('${t[a].logo}')"`,"")),e+=n}this.hotelcBlock.result.querySelectorAll(".hotelc__result__list")[0].innerHTML=e}else{for(let a=0;a<n;a++){let n=`<li class="hotelc__result--multi border-top-1">\n                        <a class="hotelc__table--avg--link" href="${t[a].book_url}" target="_blank" data-label="${a+1}-${o(t[a].logo)}-${t[a].name}" data-name="${t[a].name}">\n                            <div class="hotelc__table--avg hotelc__table--avg--scale">\n                                <div>\n                                    <div class="full-width">\n                                        <img src="${t[a].hotel_img}" class="hotelc__img">\n                                    </div>\n                                </div>\n                                <div>\n                                    <div class="full-width wrap-normal">\n                                        <span class="hotelc__info__rating">網友評分：${t[a].guest_rating}</span>\n                                        <br>\n                                        <span class="hotelc__info__name">${t[a].name}</span>\n                                        <br>\n                                        <span class="hotelc__info__place">${t[a].place_name}</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="hotelc__table--avg hotelc__table--avg--inside-border hotelc__table--avg--60">\n                                <div>\n                                    <div class="hotelc__logo" style="background-image: url('${t[a].logo}')"></div>\n                                </div>\n                                <div>\n                                    <div class="text-right nowrap">\n                                        <div class="hotelc__price hotelc__price--green">NT$<span>${i(t[a].price)}</span>\n                                            <svg class="icon-arrow--right" viewBox="0 0 8 12">\n                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-arrow--right"></use>\n                                            </svg>\n                                        </div>\n                                        <div class="hotelc__compare">比較 ${t[a].providers_num} 個網站最低價</div>\n                                    </div>\n                                </div>\n                            </div>\n                        </a>\n                    </li>`;t[a].hotel_img||(n=n.replace(`<img src="${t[a].hotel_img}">`,"")),"https://cdn.datahc.com/Images/providers/logos/"===t[a].logo&&(n=n.replace(` style="background-image: url('${t[a].logo}')"`,"")),e+=n}this.hotelcBlock.result.querySelectorAll("ul")[0].innerHTML=e}function i(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function o(t){let e=t.split("/");return e=e[e.length-1].split("-")[0].split(".")[0]}this.changeState("result")}bindInputBtn(){const t=()=>{const t=this.inputBtn.true[0].value,e=this.inputBtn.true[1].value;this.todayStr<=t&&t<e&&(this.changeHotelcDate(t,e),this.changeState("loading"),setTimeout(()=>{this.getHotelData()},500))};t();const e=()=>{const i=this.inputBtn.true[1].value,o=!isNaN(new Date(i).getTime()),a=this.inputBtn.true[1].getAttribute("min"),s=new Date(new Date(i).getTime()-864e5),l=this.formateDate(s);this.changedCheckoutDate=!0,o?(this.changeDateZh(1,this.inputBtn.true[1].value),this.inputBtn.true[0].value>=i?(this.inputBtn.true[0].value=l,n()):t()):(this.inputBtn.true[1].value=a,this.changeDateZh(1,this.today),e())},n=()=>{const i=this.inputBtn.true[0].value,o=!isNaN(new Date(i).getTime()),a=new Date(new Date(i).getTime()+864e5),s=this.formateDate(a);this.changedCheckinDate=!0,!o||this.todayStr>i?(this.inputBtn.true[0].value=this.todayStr,this.changeDateZh(0,this.today),n()):(this.changeDateZh(0,i),this.inputBtn.true[1].setAttribute("min",s),this.inputBtn.true[1].value<=i?(this.inputBtn.true[1].value=s,e()):t())};this.inputBtn.fake[0].addEventListener("click",()=>{this.inputBtn.true[0].click(),this.inputBtn.true[0].focus(),this.clickedCheckinDate||(this.clickedCheckinDate=!0,this.recordEvent("click_on_check_in_date",this.hcEventLabel)),this.recordHotelcPaEvent("click_check in")}),this.inputBtn.fake[1].addEventListener("click",()=>{this.inputBtn.true[1].click(),this.inputBtn.true[1].focus(),this.clickedCheckoutDate||(this.clickedCheckoutDate=!0,this.recordEvent("click_on_check_out_date",this.hcEventLabel)),this.recordHotelcPaEvent("click_check out")}),this.inputBtn.true[0].addEventListener("change",n),this.inputBtn.true[1].addEventListener("change",e)}changeHotelcDate(t,e){const n=(t,e)=>{if(/^(\d{4})-(\d{2})-(\d{2})$/.test(e)&&!isNaN(new Date(e).getTime())){const n=(new Date).setTime(this.today.getTime()+6048e5);document.cookie=`${t}=${e};domain=.pixnet.net;path=/;expires=${new Date(n).toGMTString()}`}},i=`checkin=${this.platform_data.date.checkin}&checkout=${this.platform_data.date.checkout}`,o=`checkin=${t}&checkout=${e}`,a=this.links.length;for(let t=0;t<a;t++){const e=this.links[t].getAttribute("href").replace(i,o);this.links[t].setAttribute("href",e)}this.platform_data.date.checkin=t,this.platform_data.date.checkout=e,n("hotelcCheckin",t),n("hotelcCheckout",e)}changeDateZh(t,e){const n=new Date(e);this.inputBtn.fake[t].querySelectorAll("span")[0].textContent=`${n.getFullYear()} 年 ${n.getMonth()+1} 月 ${n.getDate()} 日`}formateDate(t){return`${t.getFullYear()}-${`0${t.getMonth()+1}`.slice(-2)}-${`0${t.getDate()}`.slice(-2)}`}recordEvent(t,e,n){const i=`${this.project_id}_zone2_${this.project_name}`;ga(`${this.gaName}.send`,"event",i,t,e,n),_piq.push(["trackEvent",i,t,e,n])}recordHotelcPaEvent(t){const e=this.isHotel?"Hotel Compare Prices":"Hotel Recommend";_piq.push(["trackEvent",e,t,this.label])}recordHotelLabelPaEvent(t,e){_piq.push(["trackEvent","octopusHotelLabel",t,`${this.label}:::${e}`])}}class u extends r{initProperties(t){super.initProperties(t),this.gaName="scriptBoxTracker"}bindEvent(t){let e=!1,n=window.self!==window.top?window.top.document.getElementById("in-read-rp"):t;const i=()=>{e||window.top.requestAnimationFrame(()=>{n.offsetTop<window.top.pageYOffset+window.top.innerHeight&&n.offsetTop+n.offsetHeight>window.top.pageYOffset?(super.sendTrackEvent(this.pv_link),this.recordGaEvent("scroll_into_view",!0),window.top.removeEventListener("scroll",i)):e=!1}),e=!0};window.top.addEventListener("scroll",i)}recordGaEvent(t,e){ga(`${this.gaName}.send`,"event",`${this.project_id}_RP_${this.project_name}`,t,{nonInteraction:!e})}trace(){super.initGoogleAnalytics(),super.recordPaEvent("imps"),setTimeout(()=>{this.recordGaEvent("load",!1)},this.delayTime)}compileHtml(){return this.widget_content.position_html}}class g{constructor(e=[]){this.categoryId="",this.octopusTags=[],this.articleTitle="",this.widgetParams="",this.fuzzyWidgetParams="",this.articleTitle="",this.octopusDom={},this.projectId=t("project_id")||"",this.isPreview=!!this.projectId,this.zone1=[],this.zone2=[],this.zone3=[],this.init(e),this.adNum=t("ad_num")||""}init(t){this.setConfig(t),this.serializeData()}setConfig(t){t.map(t=>{const e=t[0],n=t[1];e in this&&"function"!=typeof n&&(this[e]=n)})}serializeData(){this.widgetParams=`?category_id=${this.categoryId}&article_title=${encodeURIComponent(this.articleTitle)}&project_id=${this.projectId}`,this.octopusTags.length>0&&(this.widgetParams+="&"+this.octopusTags.map(t=>`tags[]=${encodeURIComponent(t)}`).join("&")),this.setProjectNumbers(),this.setIsLogin(),this.setUrl()}setProjectNumbers(){let t="";Array.from(this.octopusDom).forEach(e=>{let n=e.dataset.zone;t+=`&position_num[Zone${n}]=1`}),this.widgetParams+=t}setIsLogin(){this.widgetParams+=`&is_login=${window.top.pix&&window.top.pix.member_token?"1":"0"}`}setUrl(){this.widgetParams+=`&url=${encodeURI(location.href)}`}async run(){if(-1==this.widgetParams.indexOf("position_num"))return;let t=c;try{const n=await e.get(t+this.widgetParams);if(n.error)return window.showAnchor=!0,void this.handleError("noMatchWidget");this.generate(n.widgets)}catch(t){console.log(t)}}async placeAds(t){this.octopusDom=[...document.querySelectorAll(t)].filter(t=>"done"!==t.dataset.process),this.serializeData(),this.run()}generate(t){Array.from(this.octopusDom).map(e=>{let n=e.dataset.zone,i=this.getContent(t,n);i||"3"!==n||(window.showAnchor=!0,this.handleError("noMatchCta")),i&&"done"!==e.dataset.process&&"3"!==n&&(e.innerHTML=i.compileHtml(),i.isHotelRecommendDiy&&e.classList.add("recommend-diy"),a(e),i.trace(),i.bindEvent(e),e.dataset.process="done")})}getContent(e,n){let i=null,o=`Zone${n}`,a=null;if(e[o]){if((a=e[o][0]).isPreview=this.isPreview,a.octopusTags=this.octopusTags,"script"===(a=this.addClickSource(a)).content_type&&"3"!==n)return new u(a);switch(n){case"1":i=new h(a);break;case"2":i=new p(a);break;case"3":if(window.location.hostname==="falcondemo.pixnet.net"+pix.domain_append&&"on"===t("is_ignore_cta"))break;i=a,window.PixnetHappixPilot&&PixnetHappixPilot.setGiftNotificationData(a);break;case"4":i=new h(a)}return i}}addClickSource(e){let n=t("utm_source");if(n){let t=e.widget_content.link,i=`${t}${t.includes("?")?"&":"?"}source=${n}`;e.widget_content.link=i}return e}noMatchCta(){window.PixnetHappixPilot&&PixnetHappixPilot.activateHappixNotificationFlow&&PixnetHappixPilot.activateHappixNotificationFlow()}anchorHandler(){const t=950,e=window.pageYOffset<t;let n=!1;const i=function(){if(window.pageYOffset>=t&&!n){if(n=!0,window.removeEventListener("scroll",i),this.checkSideSticker())return;if(!e)return void this.activeAnchor();this.activeAnchor()}}.bind(this);window.addEventListener("scroll",i)}checkBackdrop(){return!!document.querySelector("#pixnet-backdrop-ad_frame")}checkSideSticker(){return!!document.querySelector(".pixnet-side-sticker_side-box")}async activeAnchor(){const n={bigPosition:{mainId:"3879",mergeId:"3983"},smallPosition:{mainId:"3869",mergeId:"3874"},blackPosition:{mainId:"3884"}};let i={main:"smallPosition",next:"bigPosition"};const o=screen.height>=667;o&&Math.random()>=.3&&(i.main="bigPosition",i.next="smallPosition"),l()&&(i.main="blackPosition",i.next="");let a=n[i.main].mainId;"on"===t("is_ignore_ad_rules")&&(a=this.adNum);const s=`\n            <ins\n                class="adsbyfalcon"\n                data-ad-client="1"\n                data-ad-slot="${a}"\n                ${this.adNum||"blackPosition"===i.main||this.checkBackdrop()?"":`data-merge-position="${n[i.main].mergeId}"`}\n                ${o&&"blackPosition"!==i.main?`data-next-position="${n[i.next].mainId}"`:""}\n                ${o&&"blackPosition"!==i.main&&!this.checkBackdrop()?`data-next-merge-position="${n[i.next].mergeId}"`:""}\n                data-embed="false"\n            ></ins>\n        `,c=document.querySelector(".anchor-ad");if("function"==typeof window.PIXFalcon&&document.body.contains(c)){const t=new PIXFalcon;c.insertAdjacentHTML("afterbegin",s),t.placeAds(".anchor-ad")}let r="3944";o&&(r="3939");const d=`https://falcon.pixnet.net/ad/json/${r}`;e.get(d+"?version=2")}handleError(t){window.pix&&window.pix.isMobile?this.anchorHandler():"noMatchWidget"!==t?"noMatchCta"===t&&this.noMatchCta():this.noMatchWidget()}noMatchInRead(){const t=window.top.document.querySelector(".article-content-inner #in-read-rp"),e=window.location!==window.parent.location&&document.querySelector(".in-read-rp");if(t&&e){const e=t.querySelector("iframe");e&&e.offsetHeight&&(e.style.height=0,e.parentNode.style.height=0)}}noMatchWidget(){this.noMatchCta(),this.noMatchInRead()}}(async t=>{const e=new g(t._oq);await e.run()})(window),window.OctopusSDK=g}();
